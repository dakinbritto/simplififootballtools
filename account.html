<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Account - Simplifi Football</title>

  <!-- Geist Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Geist:wght@400;500;600&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    body, input, label, button {
      font-family: 'Geist', sans-serif !important;
    }

    .glass {
      background: rgba(26, 26, 26, 0.82);
      box-shadow: 0 8px 40px 5px rgba(74, 222, 128, 0.10), 0 2px 12px 2px rgba(74, 222, 128, 0.15);
      backdrop-filter: blur(18px);
      border: 1.5px solid rgba(74, 222, 128, 0.10);
      border-radius: 1.25rem;
      position: relative;
    }
    .glass::before {
      content: '';
      pointer-events: none;
      z-index: 0;
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: linear-gradient(120deg, rgba(74, 222, 128, 0.10) 0%, rgba(0, 212, 170, 0.05) 60%, #1a1a1a 100%);
      opacity: 0.35;
    }

    .btn {
      display: inline-flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 3rem;
      border-radius: 999px;
      transition: 0.25s ease;
      border: 1px solid rgba(74, 222, 128, 0.25);
      background: rgba(0,0,0,0.65);
      color: #fff;
      position: relative;
      overflow: hidden;
    }
    .btn:hover {
      transform: translateY(-1px);
      border-color: rgba(74, 222, 128, 0.65);
      box-shadow: 0 12px 30px rgba(74, 222, 128, 0.10);
    }
    .btn:active {
      transform: translateY(0px);
    }

    .btn-primary {
      border: double 1px transparent;
      background-image: linear-gradient(#000000, #000000),
        linear-gradient(
          137.48deg,
          #4ade80 10%,
          #00d4aa 45%,
          #10b981 67%,
          #059669 87%
        );
      background-origin: border-box;
      background-clip: content-box, border-box;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: .5rem;
      border: 1px solid rgba(74, 222, 128, 0.25);
      background: rgba(0,0,0,0.45);
      padding: .4rem .7rem;
      border-radius: 999px;
      font-size: .85rem;
      color: rgba(255,255,255,0.9);
    }

    .message {
      border-radius: .75rem;
      padding: .75rem .85rem;
      font-size: .9rem;
      border: 1px solid transparent;
    }
    .message.error {
      background: rgba(239, 68, 68, 0.10);
      border-color: rgba(239, 68, 68, 0.30);
      color: #ef4444;
    }
    .message.success {
      background: rgba(74, 222, 128, 0.10);
      border-color: rgba(74, 222, 128, 0.30);
      color: #4ade80;
    }

    .divider {
      border-top: 1px solid rgba(255,255,255,0.08);
    }
  </style>
</head>

<body class="min-h-screen bg-black text-gray-200 overflow-x-hidden relative">
  <!-- Background grid -->
  <div class="absolute inset-0 opacity-10 pointer-events-none">
    <svg class="w-full h-full" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
          <path d="M 10 0 L 0 0 0 10" fill="none" stroke="#4ade80" stroke-width="0.5"/>
        </pattern>
      </defs>
      <rect width="100" height="100" fill="url(#grid)" />
    </svg>
  </div>

  <main class="relative z-10 max-w-md mx-auto px-4 py-10">
    <div class="glass px-6 py-7">
      <!-- Header -->
      <div class="relative z-10 flex items-center gap-4">
        <span class="inline-flex h-12 w-12 items-center justify-center ring-2 ring-emerald-500/30 bg-emerald-500/10 rounded-xl overflow-hidden">
          <img src="https://i.postimg.cc/1z8RL6S7/reallygreatsite-com-3-removebg-preview.png?w=800&q=80" alt="Simplifi Football" class="h-9 w-9" loading="lazy">
        </span>
        <div>
          <h1 class="text-white text-2xl font-semibold tracking-tight">Account</h1>
          <p class="text-gray-400 text-sm">Manage your access and share Simplifi</p>
        </div>
      </div>

      <!-- Message -->
      <div id="messageContainer" class="relative z-10 mt-5 hidden"></div>

      <!-- Account summary -->
      <div class="relative z-10 mt-5 space-y-3">
        <div class="flex items-center justify-between gap-3">
          <div class="text-sm text-gray-400">Signed in as</div>
          <div id="emailValue" class="text-sm text-white font-medium truncate max-w-[230px]">—</div>
        </div>

        <div class="flex items-center justify-between gap-3">
          <div class="text-sm text-gray-400">Plan status</div>
          <div class="pill">
            <i data-lucide="badge-check" class="w-4 h-4 text-emerald-400"></i>
            <span id="planValue" class="text-sm text-white">—</span>
          </div>
        </div>
      </div>

      <div class="relative z-10 my-6 divider"></div>

      <!-- Invite a friend -->
      <section class="relative z-10">
        <div class="flex items-center gap-2">
          <i data-lucide="gift" class="w-5 h-5 text-emerald-400"></i>
          <h2 class="text-white text-lg font-semibold">Invite a friend</h2>
        </div>
        <p class="text-gray-400 text-sm mt-1">
          Share your link. If they sign up, they’ll start on the free plan.
        </p>

        <div class="mt-4 space-y-3">
          <label class="block text-xs text-gray-400">Your share link</label>
          <div class="flex gap-2">
            <input
              id="shareLink"
              type="text"
              readonly
              class="w-full rounded-lg bg-gray-900/70 border border-gray-700 px-4 py-3 text-white placeholder-gray-500 focus:outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition"
              value="https://simplififootballtools.vercel.app/free.html"
            />
            <button id="copyBtn" class="btn btn-primary w-[9.5rem]">
              <span class="text-[12px] tracking-[0.2em] font-semibold">COPY</span>
            </button>
          </div>

          <a id="shareBtn" class="btn" href="#" role="button">
            <i data-lucide="share-2" class="w-4 h-4 text-emerald-400 mr-2"></i>
            <span class="text-sm font-medium">Share</span>
          </a>
        </div>
      </section>

      <div class="relative z-10 my-6 divider"></div>

      <!-- Logout -->
      <section class="relative z-10">
        <button id="logoutBtn" class="btn">
          <i data-lucide="log-out" class="w-4 h-4 text-red-400 mr-2"></i>
          <span class="text-sm font-medium">Log out</span>
        </button>
      </section>

      <!-- Footer -->
      <div class="relative z-10 text-center mt-6">
        <p class="text-gray-500 text-xs">© 2024 Simplifi Football. All rights reserved.</p>
      </div>
    </div>
  </main>

  <script>
    // IMPORTANT: matches your auth.html
    const API_BASE = "https://us-central1-simplififootball-1234.cloudfunctions.net/api";

    // Marketing / share link you want people to use
    // (You can change this to market.html if you prefer)
    const DEFAULT_SHARE_LINK = "https://simplififootballtools.vercel.app/free.html";

    const messageContainer = document.getElementById("messageContainer");
    const emailValue = document.getElementById("emailValue");
    const planValue = document.getElementById("planValue");
    const shareLinkInput = document.getElementById("shareLink");
    const copyBtn = document.getElementById("copyBtn");
    const shareBtn = document.getElementById("shareBtn");
    const logoutBtn = document.getElementById("logoutBtn");

    function showMessage(text, type = "error") {
      messageContainer.className = `message ${type}`;
      messageContainer.textContent = text;
      messageContainer.classList.remove("hidden");
    }
    function hideMessage() {
      messageContainer.classList.add("hidden");
    }

    function getToken() {
      return localStorage.getItem("authToken") || "";
    }

    function setAccountUI({ email, subscriptionStatus }) {
      emailValue.textContent = email || "—";
      planValue.textContent = subscriptionStatus || "free";

      // keep localStorage in sync (handy for other pages)
      if (email) localStorage.setItem("userEmail", email);
      if (subscriptionStatus) localStorage.setItem("subscriptionStatus", subscriptionStatus);
    }

    async function fetchProfileAndSync() {
      const token = getToken();
      if (!token) return null;

      const res = await fetch(`${API_BASE}/auth/profile`, {
        headers: { "Authorization": `Bearer ${token}` }
      });

      const data = await res.json();
      if (!data.success) return null;

      return data.user;
    }

    async function init() {
      lucide.createIcons();
      hideMessage();

      // 1) Auth gate
      const token = getToken();
      if (!token) {
        window.location.href = "https://simplififootballtools.vercel.app/free.html";
        return;
      }

      // 2) Set from localStorage immediately (fast UI)
      const lsEmail = localStorage.getItem("userEmail") || "";
      const lsStatus = localStorage.getItem("subscriptionStatus") || "free";
      setAccountUI({ email: lsEmail, subscriptionStatus: lsStatus });

      // 3) Then verify token with backend + refresh values
      try {
        const user = await fetchProfileAndSync();
        if (!user) {
          // token invalid/expired
          localStorage.removeItem("authToken");
          localStorage.removeItem("userEmail");
          localStorage.removeItem("subscriptionStatus");
          window.location.href = "https://simplififootballtools.vercel.app/free.html";
          return;
        }
        setAccountUI({ email: user.email, subscriptionStatus: user.subscriptionStatus });
      } catch (e) {
        // If backend hiccups, keep UI but warn
        showMessage("Couldn’t refresh profile right now. You may be offline.", "error");
      }

      // Share link
      shareLinkInput.value = DEFAULT_SHARE_LINK;

      // Copy
      copyBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(shareLinkInput.value);
          showMessage("Copied to clipboard ✅", "success");
          setTimeout(hideMessage, 1600);
        } catch (e) {
          showMessage("Copy failed — please copy manually.", "error");
        }
      });

      // Native share (mobile)
      shareBtn.addEventListener("click", async (e) => {
        e.preventDefault();
        const url = shareLinkInput.value;

        if (navigator.share) {
          try {
            await navigator.share({
              title: "Simplifi Football",
              text: "Join me on Simplifi Football tools:",
              url
            });
          } catch (_) {
            // user cancelled, ignore
          }
          return;
        }

        // fallback: copy
        try {
          await navigator.clipboard.writeText(url);
          showMessage("Share not supported here — link copied ✅", "success");
          setTimeout(hideMessage, 1600);
        } catch (e2) {
          showMessage("Share not supported — please copy the link manually.", "error");
        }
      });

      // Logout
      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("authToken");
        localStorage.removeItem("userEmail");
        localStorage.removeItem("subscriptionStatus");
        window.location.href = "https://simplififootballtools.vercel.app/free.html";
      });
    }

    window.addEventListener("load", init);
  </script>
</body>
</html>
